<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login & Register - DonatSur</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <script>
    (function(){
      emailjs.init("DdpIOOYV5FP2GKg1"); // ðŸ”‘ Ganti dengan public key EmailJS kamu
    })();
  </script>
  <style>
    /* Form styling */
    .auth-container {
      max-width: 420px;
      margin: 80px auto;
      background: #fff;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }

    .auth-container h2 {
      text-align: center;
      color: #333;
      margin-bottom: 20px;
    }

    input[type="text"], input[type="password"], input[type="email"], input[type="number"] {
      width: 100%;
      padding: 10px;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 8px;
    }

    button {
      width: 100%;
      padding: 10px;
      background-color: #f3c623;
      border: none;
      border-radius: 8px;
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: 0.2s;
    }

    button:hover {
      background-color: #e2b71f;
    }

    .link {
      display: block;
      text-align: center;
      margin-top: 10px;
      color: #555;
      cursor: pointer;
    }

    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <div class="auth-container">
    <!-- LOGIN -->
    <div id="loginForm">
      <h2>Login DonatSur</h2>
      <input type="email" id="loginEmail" placeholder="Email" required>
      <input type="password" id="loginPassword" placeholder="Password" required>
      <button onclick="login()">Masuk</button>
      <div class="link" onclick="showRegister()">Belum punya akun? Daftar</div>
      <div class="link" onclick="showForgot()">Lupa Password?</div>
    </div>

    <!-- REGISTER -->
    <div id="registerForm" class="hidden">
      <h2>Daftar Akun Baru</h2>
      <input type="text" id="regName" placeholder="Nama Lengkap" required>
      <input type="email" id="regEmail" placeholder="Email" required>
      <input type="password" id="regPassword" placeholder="Password" required>
      <input type="number" id="regPhone" placeholder="No HP" required>
      <button onclick="register()">Daftar</button>
      <div class="link" onclick="showLogin()">Sudah punya akun? Login</div>
    </div>

    <!-- VERIFIKASI KODE -->
    <div id="verifyForm" class="hidden">
      <h2>Verifikasi Kode Gmail</h2>
      <p>Masukkan 6 digit kode yang dikirim ke Gmail Anda</p>
      <input type="number" id="verifyCodeInput" placeholder="Masukkan kode 6 digit">
      <button onclick="verifyCode()">Verifikasi</button>
      <div class="link" onclick="showLogin()">Kembali ke Login</div>
    </div>

    <!-- FORGOT PASSWORD -->
    <div id="forgotForm" class="hidden">
      <h2>Lupa Password</h2>
      <input type="text" id="forgotName" placeholder="Nama Lengkap" required>
      <input type="email" id="forgotEmail" placeholder="Email" required>
      <input type="number" id="forgotPhone" placeholder="No HP" required>
      <button onclick="forgotPassword()">Kirim Password Baru</button>
      <div class="link" onclick="showLogin()">Kembali ke Login</div>
    </div>
  </div>

  <script>
    // Navigasi antar form
    function showLogin() {
      hideAll();
      document.getElementById("loginForm").classList.remove("hidden");
    }
    function showRegister() {
      hideAll();
      document.getElementById("registerForm").classList.remove("hidden");
    }
    function showForgot() {
      hideAll();
      document.getElementById("forgotForm").classList.remove("hidden");
    }
    function showVerify() {
      hideAll();
      document.getElementById("verifyForm").classList.remove("hidden");
    }
    function hideAll() {
      document.querySelectorAll(".auth-container > div").forEach(div => div.classList.add("hidden"));
    }

    // Simpan kode sementara di browser
    let generatedCode = null;
    let regData = {};

    // REGISTER â€” kirim kode 6 digit ke Gmail
    function register() {
      const name = document.getElementById("regName").value;
      const email = document.getElementById("regEmail").value;
      const phone = document.getElementById("regPhone").value;
      const password = document.getElementById("regPassword").value;

      if (!name || !email || !phone || !password) {
        alert("Semua kolom wajib diisi!");
        return;
      }

      generatedCode = Math.floor(100000 + Math.random() * 900000);
      regData = { name, email, phone, password };

      emailjs.send("service_1kqx0ch", "template_e00tsb8", {
        to_name: name,
        to_email: email,
        message: `Halo ${name}, kode verifikasi akun DonatSur kamu adalah ${generatedCode}. Berlaku 5 menit.`,
      })
      .then(() => {
        alert("Kode verifikasi telah dikirim ke Gmail Anda!");
        showVerify();
      }, (err) => {
        console.error("EmailJS Error:", err);
        alert("Gagal mengirim email verifikasi.");
      });
    }

    // VERIFIKASI
    function verifyCode() {
      const inputCode = document.getElementById("verifyCodeInput").value;
      if (inputCode == generatedCode) {
        alert(`Selamat ${regData.name}, akun Anda telah berhasil dibuat!`);
        localStorage.setItem("user_" + regData.email, JSON.stringify(regData));
        showLogin();
      } else {
        alert("Kode verifikasi salah!");
      }
    }

    // LOGIN
    function login() {
      const email = document.getElementById("loginEmail").value;
      const password = document.getElementById("loginPassword").value;
      const userData = localStorage.getItem("user_" + email);

      if (!userData) {
        alert("Akun tidak ditemukan!");
        return;
      }

      const parsed = JSON.parse(userData);
      if (parsed.password === password) {
        alert(`Selamat datang kembali, ${parsed.name}!`);
      } else {
        alert("Password salah!");
      }
    }

    // LUPA PASSWORD
    function forgotPassword() {
      const name = document.getElementById("forgotName").value;
      const email = document.getElementById("forgotEmail").value;
      const newPass = "donat" + Math.floor(Math.random() * 9999);

      const stored = localStorage.getItem("user_" + email);
      if (!stored) {
        alert("Email tidak terdaftar!");
        return;
      }

      let parsed = JSON.parse(stored);
      parsed.password = newPass;
      localStorage.setItem("user_" + email, JSON.stringify(parsed));

      emailjs.send("service_1kqx0ch", "template_j7g0ivm", {
        to_name: name,
        to_email: email,
        message: `Halo ${name}, password baru Anda adalah ${newPass}. Silakan login dan ubah kembali.`,
      })
      .then(() => {
        alert("Password baru telah dikirim ke Gmail Anda!");
        showLogin();
      }, (err) => {
        console.error("EmailJS Error:", err);
        alert("Gagal mengirim password baru.");
      });
    }
  </script>
</body>
</html>